{"ast":null,"code":"import _regeneratorRuntime from\"/home/ctapang/dapp-scaffold/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ctapang/dapp-scaffold/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{PublicKey}from\"@solana/web3.js\";var INS_GET_PUBKEY=0x05;var INS_SIGN_MESSAGE=0x06;var P1_NON_CONFIRM=0x00;var P1_CONFIRM=0x01;var P2_EXTEND=0x01;var P2_MORE=0x02;var MAX_PAYLOAD=255;var LEDGER_CLA=0xe0;/*\n * Helper for chunked send of large payloads\n */function ledgerSend(_x,_x2,_x3,_x4){return _ledgerSend.apply(this,arguments);}function _ledgerSend(){_ledgerSend=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(transport,instruction,p1,payload){var p2,payloadOffset,_chunk,_reply,chunk,reply;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:p2=0;payloadOffset=0;if(!(payload.length>MAX_PAYLOAD)){_context.next=15;break;}case 3:if(!(payload.length-payloadOffset>MAX_PAYLOAD)){_context.next=15;break;}_chunk=payload.slice(payloadOffset,payloadOffset+MAX_PAYLOAD);payloadOffset+=MAX_PAYLOAD;console.log(\"send\",(p2|P2_MORE).toString(16),_chunk.length.toString(16),_chunk);_context.next=9;return transport.send(LEDGER_CLA,instruction,p1,p2|P2_MORE,_chunk);case 9:_reply=_context.sent;if(!(_reply.length!==2)){_context.next=12;break;}throw new Error(\"Received unexpected reply payload\");case 12:p2|=P2_EXTEND;_context.next=3;break;case 15:chunk=payload.slice(payloadOffset);console.log(\"send\",p2.toString(16),chunk.length.toString(16),chunk);_context.next=19;return transport.send(LEDGER_CLA,instruction,p1,p2,chunk);case 19:reply=_context.sent;return _context.abrupt(\"return\",reply.slice(0,reply.length-2));case 21:case\"end\":return _context.stop();}}},_callee);}));return _ledgerSend.apply(this,arguments);}var BIP32_HARDENED_BIT=1<<31>>>0;function harden(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return(n|BIP32_HARDENED_BIT)>>>0;}export function getSolanaDerivationPath(account,change){var length;if(account!==undefined){if(change!==undefined){length=4;}else{length=3;}}else{length=2;}var derivationPath=Buffer.alloc(1+length*4);// eslint-disable-next-line\nvar offset=0;offset=derivationPath.writeUInt8(length,offset);offset=derivationPath.writeUInt32BE(harden(44),offset);// Using BIP44\noffset=derivationPath.writeUInt32BE(harden(501),offset);// Solana's BIP44 path\nif(length>2){offset=derivationPath.writeUInt32BE(harden(account),offset);if(length===4){// @FIXME: https://github.com/project-serum/spl-token-wallet/issues/59\noffset=derivationPath.writeUInt32BE(harden(change),offset);}}return derivationPath;}export function signTransaction(_x5,_x6){return _signTransaction.apply(this,arguments);}function _signTransaction(){_signTransaction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(transport,transaction){var derivationPath,messageBytes,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:derivationPath=_args2.length>2&&_args2[2]!==undefined?_args2[2]:getSolanaDerivationPath();messageBytes=transaction.serializeMessage();return _context2.abrupt(\"return\",signBytes(transport,messageBytes,derivationPath));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return _signTransaction.apply(this,arguments);}export function signBytes(_x7,_x8){return _signBytes.apply(this,arguments);}function _signBytes(){_signBytes=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(transport,bytes){var derivationPath,numPaths,payload,_args3=arguments;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:derivationPath=_args3.length>2&&_args3[2]!==undefined?_args3[2]:getSolanaDerivationPath();numPaths=Buffer.alloc(1);numPaths.writeUInt8(1,0);payload=Buffer.concat([numPaths,derivationPath,bytes]);// @FIXME: must enable blind signing in Solana Ledger App per https://github.com/project-serum/spl-token-wallet/issues/71\n// See also https://github.com/project-serum/spl-token-wallet/pull/23#issuecomment-712317053\nreturn _context3.abrupt(\"return\",ledgerSend(transport,INS_SIGN_MESSAGE,P1_CONFIRM,payload));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _signBytes.apply(this,arguments);}export function getPublicKey(_x9){return _getPublicKey.apply(this,arguments);}function _getPublicKey(){_getPublicKey=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(transport){var derivationPath,publicKeyBytes,_args4=arguments;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:derivationPath=_args4.length>1&&_args4[1]!==undefined?_args4[1]:getSolanaDerivationPath();_context4.next=3;return ledgerSend(transport,INS_GET_PUBKEY,P1_NON_CONFIRM,derivationPath);case 3:publicKeyBytes=_context4.sent;return _context4.abrupt(\"return\",new PublicKey(publicKeyBytes));case 5:case\"end\":return _context4.stop();}}},_callee4);}));return _getPublicKey.apply(this,arguments);}","map":null,"metadata":{},"sourceType":"module"}